<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhbit.smartrecruit.dao.JobDao">
    <resultMap type="com.zhbit.smartrecruit.data.vo.JobReleaseRecordVo" id="jobReleaseRecord">
        <id column="job_id" property="jobId"/>
        <result column="job_id" property="jobId"/>
        <result column="hr_info_name" property="jobFrom"/>
        <result column="enterprise_name" property="enterpriseName"/>
        <result column="enterprise_logo" property="enterpriseLogo"/>
        <result column="job_name" property="jobName"/>
        <result column="job_property" property="jobProperty"/>
        <result column="job_responsibility" property="jobResponsibility"/>
        <result column="job_min_salary" property="jobMinSalary"/>
        <result column="job_max_salary" property="jobMaxSalary"/>
        <result column="job_education" property="jobEducation"/>
        <result column="job_experience" property="jobExperience"/>
        <result column="job_city" property="jobCity"/>
        <result column="job_address" property="jobAddress"/>
        <result column="job_datetime" property="jobDatetime"/>
        <result column="job_requirement" property="jobRequirement"/>
        <result column="delivery_count" property="deliveryCount"/>
    </resultMap>
    <select id="searchJobInfo" resultMap="jobReleaseRecord">
        SELECT
            job.job_id,
            enterprise.enterprise_name,
            enterprise.enterprise_logo,
            hr.hr_info_name,
            job.job_name,
            job.job_property,
            job.job_education,
            job.job_experience,
            job.job_min_salary,
            job.job_max_salary,
            job.job_city,
            job.job_address,
            job.job_datetime,
            job.job_responsibility,
            job.job_requirement,
            deliveryRecord.delivery_count
        FROM
            job
                JOIN
            hr_info AS hr ON job.job_from = hr.hr_info_id
                JOIN
            enterprise ON enterprise.enterprise_id = hr.hr_info_enterprise_id
                JOIN
            (SELECT
                job.job_id, record.delivery_count
            FROM
                job
            LEFT JOIN (SELECT
                job_id, COUNT(*) delivery_count
            FROM
                delivery_record
            GROUP BY job_id) AS record ON job.job_id = record.job_id) AS deliveryRecord ON job.job_name LIKE "%"#{jobName}"%"
                AND job.job_id = deliveryRecord.job_id
        ORDER BY job.job_datetime DESC;
    </select>

</mapper>